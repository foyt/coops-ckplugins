/*! CKEditor plugin coops-sessionevents - v0.1.2 - 2016-05-30
* https://github.com/foyt/coops-ckplugins
* Copyright (c) 2016 ; Licensed LGPL-v3 */
(function(){CoOpsSessionEvents=CKEDITOR.tools.createClass({$:function(a){this._editor=a,this._editor.on("CoOPS:SessionStart",this._onSessionStart,this),this._editor.on("CoOPS:BeforeSessionStart",this._onBeforeSessionStart,this),this._initialSessionEvents=null},proto:{_onBeforeSessionStart:function(a){this._initialSessionEvents=a.data.joinData.extensions.sessionEvents},_onSessionStart:function(a){this._initialSessionEvents&&(this._handleSessionEvents(this._initialSessionEvents),this._initialSessionEvents=null),this._editor.on("CoOPS:PatchReceived",this._onPatchReceived,this,null,9999)},_onPatchReceived:function(a){var b=a.data;a.data.sessionId;b.extensions&&b.extensions.sessionEvents&&this._handleSessionEvents(b.extensions.sessionEvents)},_handleSessionEvents:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];switch(d.status){case"OPEN":this._editor.fire("CoOPS:CollaboratorJoined",{displayName:d.displayName,email:d.email,sessionId:d.sessionId});break;case"CLOSE":this._editor.fire("CoOPS:CollaboratorLeft",{displayName:d.displayName,email:d.email,sessionId:d.sessionId})}}}}}),CKEDITOR.plugins.add("coops-sessionevents",{requires:["coops"],init:function(a){a.on("CoOPS:BeforeJoin",function(a){new CoOpsSessionEvents(a.editor)})}})}).call(this);